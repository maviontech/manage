<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Forgot password</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f4f7fb; --card:#fff; --primary:#0b57a4; --accent:#1f86e3; --muted:#6b7280; --danger:#dc2626;
      --radius:12px; --shadow: 0 6px 18px rgba(13, 38, 63, 0.08);
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:Inter,system-ui, -apple-system, "Segoe UI", Roboto; background:linear-gradient(180deg,#eef6ff 0%, var(--bg) 100%); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; color:#0f172a}
    .card{ width:100%; max-width:540px; background:var(--card); padding:26px; border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid rgba(15,23,42,0.04) }
    .brand{ display:flex; gap:12px; align-items:center; margin-bottom:14px }
    .logo{ width:48px; height:48px; border-radius:10px; background:linear-gradient(135deg,var(--primary),var(--accent)); color:white; display:flex; align-items:center; justify-content:center; font-weight:700}
    h1{ margin:0; font-size:18px } p.sub{ margin:4px 0 0; color:var(--muted); font-size:13px }
    label{ display:block; font-weight:600; margin-top:16px }
    input[type="email"]{ width:100%; padding:12px; border-radius:10px; border:1px solid rgba(15,23,42,0.09); font-size:15px }
    .hint{ font-size:13px; color:var(--muted); margin-top:10px }
    .inline-error{ color:var(--danger); font-size:13px; margin-top:8px; display:none }
    .error-box{ background:#fff5f5; border-radius:8px; padding:10px; color:var(--danger); margin-bottom:12px }
    button.submit{ margin-top:14px; background:linear-gradient(90deg,var(--primary),var(--accent)); border:none; color:white; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; display:inline-flex; align-items:center; gap:10px }
    .visually-hidden{ position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; border:0; padding:0; margin:-1px }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="fp-title">
    <div class="brand">
      <div class="logo">M</div>
      <div>
        <h1 id="fp-title">Forgot your password?</h1>
        <p class="sub">Enter your registered work email and we'll send a link to reset your password.</p>
      </div>
    </div>

    {% if message %}
      <div style="background:#ecfdf5;border-radius:8px;padding:10px;color:#065f46;margin-bottom:12px">{{ message }}</div>
    {% endif %}

    {% if error %}
      <div class="error-box" role="alert">{{ error }}</div>
    {% endif %}

    <form id="fp-form" method="post" novalidate>
      {% csrf_token %}
      <label for="email">Work email</label>
      <input id="email" name="email" type="email" placeholder="you@company.com" value="{{ request.POST.email|default:'' }}" required />
      <div id="email-error" class="inline-error" role="alert"></div>

      <button type="submit" class="submit" id="submit-btn">
        <span id="btn-text">Send reset link</span>
        <svg id="btn-spinner" class="visually-hidden" width="18" height="18" viewBox="0 0 50 50" aria-hidden="true">
          <circle cx="25" cy="25" r="20" stroke="white" stroke-width="4" stroke-linecap="round" fill="none" stroke-dasharray="31.4 31.4"></circle>
        </svg>
      </button>
      <p class="hint">If the email is registered, you’ll receive a reset link. For security we don’t reveal whether an address exists.</p>
      <p style="margin-top:12px"><a href="{% url 'identify' %}">Back to sign in</a></p>
    </form>
  </main>

  <script>
    (function(){
      const form = document.getElementById('fp-form');
      const email = document.getElementById('email');
      const emailError = document.getElementById('email-error');
      const submitBtn = document.getElementById('submit-btn');
      const btnText = document.getElementById('btn-text');
      const btnSpinner = document.getElementById('btn-spinner');

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;

      function showError(msg){
        emailError.textContent = msg;
        emailError.style.display = msg ? 'block' : 'none';
      }

      email.addEventListener('input', () => {
        if(!email.value.trim()) { showError(''); return; }
        if(!emailRegex.test(email.value.trim())) showError('Enter a valid email address.');
        else showError('');
      });

      form.addEventListener('submit', (e) => {
        const v = email.value.trim();
        if(!v){ e.preventDefault(); showError('Email is required.'); email.focus(); return; }
        if(!emailRegex.test(v)){ e.preventDefault(); showError('Enter a valid email address.'); email.focus(); return; }

        submitBtn.disabled = true;
        btnText.style.display = 'none';
        btnSpinner.classList.remove('visually-hidden');
      });
    })();
  </script>
</body>
</html>
