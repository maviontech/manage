{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-semibold text-primary mb-0">
      <i class="fa-solid fa-file-csv me-2"></i> Bulk Import Tasks
    </h4>
    <div>
      <a href="{% url 'my_tasks' %}" class="btn btn-sm btn-outline-secondary me-2">
        <i class="fa-solid fa-arrow-left"></i> Back to My Tasks
      </a>
      <a href="{% url 'task_board' %}" class="btn btn-sm btn-primary">
        <i class="fa-solid fa-th-large"></i> Task Board
      </a>
    </div>
  </div>

  <!-- Upload Card -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <p class="text-muted mb-4">
        You can upload a CSV file to bulk create or import tasks into the system.
        Ensure your file follows the correct header format shown below.
      </p>

      <div class="alert alert-info small">
        <strong>Expected Columns:</strong><br>
        <code>title, description, project_id, subproject_id, status, priority, assigned_to, due_date</code>
      </div>

      <!-- Upload Form -->
      <form method="post" enctype="multipart/form-data" class="mt-4">
        {% csrf_token %}
        <div class="row align-items-center">
          <div class="col-md-8">
            <div class="form-group mb-3">
              <label for="csv_file" class="form-label fw-semibold">Select CSV File</label>
              <input type="file" name="csv_file" id="csv_file" accept=".csv" required class="form-control form-control-lg">
            </div>
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary btn-lg w-100">
              <i class="fa-solid fa-upload me-2"></i> Upload & Import
            </button>
          </div>
        </div>
      </form>

      <!-- Sample CSV Download -->
      <div class="mt-4">
        <a href="{% static 'samples/sample_tasks_import.csv' %}" download class="btn btn-outline-info btn-sm">
          <i class="fa-solid fa-download"></i> Download Sample CSV
        </a>
      </div>
    </div>
  </div>

  <!-- Instructions -->
  <div class="card mt-4 border-0 shadow-sm">
    <div class="card-body">
      <h6 class="fw-semibold mb-3 text-primary">
        <i class="fa-solid fa-circle-info me-2"></i> Instructions for Preparing the CSV
      </h6>
      <ul class="small text-muted mb-0">
        <li>Make sure the header row matches the expected column names exactly.</li>
        <li><code>status</code> can be one of: <em>Open</em>, <em>In Progress</em>, <em>Review</em>, <em>Blocked</em>, <em>Closed</em>.</li>
        <li><code>priority</code> can be one of: <em>Low</em>, <em>Normal</em>, <em>High</em>, <em>Critical</em>.</li>
        <li><code>assigned_to</code> can be empty, or use format <code>member:ID</code> or <code>team:ID</code>.</li>
        <li><code>due_date</code> should be in <code>YYYY-MM-DD</code> format.</li>
        <li>Large imports (1000+ rows) may take longer; the system will show results after processing.</li>
      </ul>
    </div>
  </div>
</div>

<style>
label.form-label {
  font-weight: 500;
  color: #0b57a4;
}
.card {
  border-radius: 12px;
}
.btn-lg i {
  font-size: 0.9rem;
}
code {
  background-color: #f6f8fa;
  padding: 3px 6px;
  border-radius: 4px;
}
</style>
{% endblock %}
