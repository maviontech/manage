{# Reusable attachments block: drag/drop + file list. #}
<style>
  .attachments-card {
    margin: 1.25rem 0 1.5rem 0;
    border-radius: 12px;
    border: 2px dashed rgba(226,232,240,0.8);
    padding: 1.5rem;
    background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(250,250,250,0.6));
    text-align: center;
  }
  .attachments-dropzone {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 18px;
    border-radius: 10px;
    cursor: pointer;
    transition: background .15s ease, border-color .15s ease, transform .08s ease;
  }
  .attachments-dropzone.dragover { background: rgba(59,130,246,0.04); border-color: rgba(59,130,246,0.25); }
  .attachments-hint { color: #64748b; font-size: 0.9rem; }
  .attachments-list { margin-top: 12px; text-align: left; }
  .attachments-list li { padding: 8px 10px; border-radius:8px; background: #fff; border:1px solid #eef2f7; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; }
  .attachments-list .remove { color:#ef4444; cursor:pointer; margin-left:12px; }
  .attachments-meta { font-size:0.85rem; color:#94a3b8; margin-top:8px; }
</style>

<div class="attachments-card">
  <label class="attachments-dropzone" for="attachmentsInput">
    <div>
      <i class="fa-solid fa-cloud-arrow-up" style="font-size:20px;color:#2563eb"></i>
    </div>
    <div style="text-align:left">
      <div style="font-weight:700;color:#0f172a">Click to upload or drag and drop</div>
      <div class="attachments-hint">Screenshots, logs, or documents (Max 10MB per file, up to 5 files)</div>
    </div>
  </label>

  <input type="file" id="attachmentsInput" name="attachments" multiple style="display:none" accept="image/*,.pdf,.txt,.log,.doc,.docx,.xls,.xlsx" />

  <ul id="attachmentsList" class="attachments-list" aria-live="polite"></ul>
  <div class="attachments-meta">Accepted formats: Images, PDF, TXT, LOG, DOC, DOCX, XLS, XLSX.</div>
</div>

<script>
  (function(){
    const input = document.getElementById('attachmentsInput');
    const dropzone = document.querySelector('.attachments-dropzone');
    const list = document.getElementById('attachmentsList');
    const MAX_FILES = 5;
    const MAX_SIZE = 10 * 1024 * 1024; // 10MB

    function humanSize(bytes){
      if(bytes < 1024) return bytes + ' B';
      if(bytes < 1024*1024) return (bytes/1024).toFixed(1) + ' KB';
      return (bytes/(1024*1024)).toFixed(1) + ' MB';
    }

    function renderFiles(files){
      list.innerHTML = '';
      Array.from(files).forEach((f, idx)=>{
        const li = document.createElement('li');
        li.textContent = f.name + ' â€” ' + humanSize(f.size);
        const remove = document.createElement('span');
        remove.className = 'remove';
        remove.innerHTML = '<i class="fa-solid fa-trash"></i>';
        remove.addEventListener('click', ()=>{
          const dt = new DataTransfer();
          Array.from(input.files).forEach((file,i)=>{ if(i!==idx) dt.items.add(file); });
          input.files = dt.files;
          renderFiles(input.files);
        });
        li.appendChild(remove);
        list.appendChild(li);
      });
    }

    dropzone.addEventListener('click', ()=> input.click());

    dropzone.addEventListener('dragover', function(e){ e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave', function(e){ dropzone.classList.remove('dragover'); });
    dropzone.addEventListener('drop', function(e){
      e.preventDefault(); dropzone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      handleNewFiles(files);
    });

    input.addEventListener('change', function(){ handleNewFiles(this.files); });

    function handleNewFiles(fileList){
      const existing = Array.from(input.files || []);
      const incoming = Array.from(fileList || []);
      const combined = existing.concat(incoming);

      if(combined.length > MAX_FILES){ alert('Maximum ' + MAX_FILES + ' files allowed'); return; }

      for(const f of incoming){ if(f.size > MAX_SIZE){ alert(f.name + ' exceeds 10MB limit'); return; } }

      const dt = new DataTransfer();
      combined.forEach(f => dt.items.add(f));
      input.files = dt.files;
      renderFiles(input.files);
    }
  })();
</script>
