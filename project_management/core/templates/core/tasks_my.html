{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">


  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="fw-bold mb-1 text-gradient">
        <i class="fa-solid fa-clipboard-list me-2"></i> My Tasks
      </h4>
      <p class="text-muted small mb-0">View, track and manage your assigned work items.</p>
    </div>
    <div>
      <a href="{% url 'create_task' %}" class="btn btn-gradient me-2">
        <i class="fa-solid fa-plus"></i> New Task
      </a>
      <a href="{% url 'task_board' %}" class="btn btn-outline-gradient">
        <i class="fa-solid fa-th-large"></i> Board View
      </a>
    </div>
  </div>

  <!-- TABLE CARD -->
  <div class="card soft-card">
    <div class="card-body p-0">
      {% if tasks %}
      <div class="table-responsive">
        <table class="table align-middle mb-0 table-hover modern-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Due</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tasks %}
            <tr>
              <td class="text-muted small">{{ forloop.counter }}</td>
              <td>
                <div class="fw-semibold text-truncate">{{ t.title }}</div>
                <small class="text-muted">#{{ t.id }}</small>
              </td>
              <td>
                <span class="badge priority {{ t.priority|lower }}">{{ t.priority }}</span>
              </td>
              <td>
                <span class="badge status {{ t.status|slugify }}">
                  <i class="fa-solid fa-circle me-1"></i> {{ t.status }}
                </span>
              </td>
              <td>
                {% if t.due_date %}
                  <span class="{% if t.due_date < today %}text-danger fw-semibold{% else %}text-muted{% endif %}">
                    <i class="fa-regular fa-clock me-1"></i>{{ t.due_date }}
                  </span>
                {% else %}
                  <span class="text-muted">â€”</span>
                {% endif %}
              </td>
              <td class="text-end">
                <a href="{% url 'task_detail' t.id %}" class="btn btn-sm btn-light action-btn" title="View"><i class="fa-solid fa-eye"></i></a>
                <a href="{% url 'task_edit' t.id %}" class="btn btn-sm btn-light action-btn" title="Edit"><i class="fa-solid fa-pen"></i></a>
                <button class="btn btn-sm btn-light action-btn text-danger" title="Delete"><i class="fa-solid fa-trash"></i></button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="p-5 text-center text-muted">
        <i class="fa-regular fa-circle-check fa-2x mb-3"></i><br>
        You have no assigned tasks.
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- appended CSS: keeps your original styles and forces the submenu to viewport-fixed right center -->
<style>
/* preserve the original visual tokens */
.text-gradient { background: linear-gradient(90deg,#0b57a4,#38bdf8); -webkit-background-clip:text; color:transparent; }
.btn-gradient { background: linear-gradient(90deg,#0b57a4,#1f86e3,#38bdf8); color:#fff; border:none; border-radius:8px; padding:8px 14px; }
.btn-outline-gradient { border:1px solid #38bdf8; color:#0b57a4; border-radius:8px; padding:6px 12px; }
.soft-card { border-radius:12px; box-shadow:0 6px 18px rgba(13,38,71,0.06); border:none; }
.modern-table thead { background: linear-gradient(90deg, rgba(11,87,164,0.06), rgba(31,134,227,0.04)); color:#0b57a4; font-weight:600; }
.priority.low { background:#adb5bd; color:#fff; } .priority.normal { background:#0dcaf0; color:#00303f; } .priority.high { background:#ffc107; color:#1f1f1f; } .priority.critical { background:#dc3545; color:#fff; }
.status.closed { background:#198754; color:#fff; } .status.blocked { background:#212529; color:#fff; } .status.review { background:#ffc107; } .status.in-progress { background:#0b57a4; color:#fff; }
.action-btn { border-radius:8px; border:1px solid rgba(0,0,0,0.04); }

/* ---------- FIX: Position submenu fixed to viewport right and vertically centered ---------- */

/* make sure main container doesn't trap submenu positioning */
.container-fluid { position: relative; }

/* Position submenu fixed to viewport so it stays vertically centered regardless of page layout */
.task-submenu {
  position: fixed !important;
  right: 48px !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  z-index: 1200 !important;
  pointer-events: auto !important;
  width: 320px !important;
  margin: 0 !important;
}

/* submenu card */
.submenu-card {
  border-radius: 12px;
  padding: 10px;
  color: #fff;
  background: linear-gradient(180deg, rgba(11,87,164,0.96), rgba(31,134,227,0.92));
  box-shadow: 0 20px 40px rgba(11,87,164,0.09), inset 0 1px 0 rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(6px);
  overflow: visible;
}

/* compact list */
.submenu-list-compact { display:flex; flex-direction:column; gap:10px; padding:6px; }

/* items & hover glow */
.submenu-item-compact {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:10px;
  color:rgba(255,255,255,0.95); text-decoration:none; font-weight:600;
  transition: box-shadow .18s ease, transform .12s ease, background-color .12s ease, color .12s;
  border-left: 3px solid transparent; background: transparent; position:relative;
}
.submenu-item-compact:hover {
  transform: translateY(-2px);
  color: #fff !important;
  background: rgba(255,255,255,0.16) !important;
  box-shadow:
    0 0 18px rgba(255,255,255,0.65),
    0 0 36px rgba(255,255,255,0.35),
    0 0 60px rgba(255,255,255,0.18);
  border-left-color: rgba(255,255,255,0.95) !important;
}
.submenu-item-compact::after {
  content: "";
  position: absolute; left: -40%; top: -30%;
  width: 140%; height: 80%;
  background: linear-gradient(90deg, rgba(255,255,255,0.00), rgba(255,255,255,0.22), rgba(255,255,255,0.00));
  transform: rotate(-20deg);
  opacity: 0; transition: transform .45s ease, opacity .25s ease; pointer-events:none;
}
.submenu-item-compact:hover::after { transform: rotate(-18deg) translateX(-6%); opacity: 1; }

.submenu-item-compact.active {
  background: rgba(255,255,255,0.12) !important;
  color: #ffffff !important;
  border-left-color: #10b981 !important;
  box-shadow: 0 0 18px rgba(16,185,129,0.18) !important;
}
.submenu-card, .submenu-item-compact { overflow: visible !important; }

/* Responsive behavior: on narrow screens stack submenu below content */
@media (max-width: 992px) {
  .task-submenu {
    position: static !important;
    transform: none !important;
    width: 100% !important;
    margin-top: 12px !important;
  }
  .container-fluid { position: static; }
}
</style>
{% endblock %}
