{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">

  <!-- HEADER -->
  <div class="page-header-card">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
          My Tasks
        </h1>
        <p class="page-subtitle">View, track and manage your assigned work items</p>
      </div>
      <div class="header-actions">
        <select id="workTypeFilter" class="filter-select">
          <option value="">All work types</option>
          <option value="Task">Task</option>
          <option value="Bug">Bug</option>
          <option value="Story">Story</option>
          <option value="Defect">Defect</option>
          <option value="Sub Task">Sub Task</option>
          <option value="Report">Report</option>
          <option value="Change Request">Change Request</option>
        </select>
        <a href="{% url 'create_task' %}" class="btn-modern btn-primary">
          <i class="fa-solid fa-plus"></i>
          New Task
        </a>
        <a href="{% url 'task_board' %}" class="btn-modern btn-primary">
          <i class="fa-solid fa-th-large"></i>
          Board View
        </a>
      </div>
    </div>
  </div>

  <!-- TABLE CARD -->
  <div class="tasks-table-card">
    {% if tasks %}
    <div class="table-responsive">
      <table class="tasks-table">
        <thead>
          <tr>
            <th style="width: 80px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
              </svg>
              ID
            </th>
            <th style="min-width: 350px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
              </svg>
              Title
            </th>
            <th style="width: 130px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              Priority
            </th>
            <th style="width: 100px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
              Status
            </th>
            <th style="width: 170px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              Due Date
            </th>
            <th style="width: 170px;">
              <svg width="10" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 1rem;">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
              Closed
            </th>
            <th style="width: 180px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for t in tasks %}
          <tr class="task-row" data-href="{% url 'task_detail' t.id %}" data-work-type="{{ t.work_type|default:'Task' }}">
            <td>
              <span class="task-id">#{{ t.id }}</span>
            </td>
            <td>
              <div class="task-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" style="flex-shrink: 0;">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                <span class="work-type-mini-badge work-type-{{ t.work_type|default:'Task'|lower|cut:' ' }}">
                  {{ t.work_type|default:'Task' }}
                </span>
                {{ t.title }}
              </div>
            </td>
            <td>
              <span class="priority-badge priority-{{ t.priority|lower }}">
                {% if t.priority == 'Critical' %}
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12" stroke="white" stroke-width="2"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16" stroke="white" stroke-width="2"></line>
                  </svg>
                {% elif t.priority == 'High' %}
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <polyline points="18 15 12 9 6 15"></polyline>
                  </svg>
                {% elif t.priority == 'Low' %}
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                {% endif %}
                {{ t.priority }}
              </span>
            </td>
            <td>
              <span class="status-badge status-{{ t.status|slugify }}">
                {{ t.status }}
              </span>
            </td>
            <td>
              {% if t.due_date %}
                <span class="date-badge {% if t.due_date < today %}date-overdue{% else %}date-normal{% endif %}">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  {{ t.due_date|date:"M d, Y" }}
                </span>
              {% else %}
                <span class="date-badge date-empty">—</span>
              {% endif %}
            </td>
            <td>
              {% if t.closure_date %}
                <span class="date-badge date-completed">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  </svg>
                  {{ t.closure_date|date:"M d, Y" }}
                </span>
              {% else %}
                <span class="date-badge date-empty">—</span>
              {% endif %}
            </td>
            <td>
              <div class="action-buttons">
                <a href="{% url 'edit_task' t.id %}" class="btn-action btn-edit" title="Edit Task" onclick="event.stopPropagation();">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="2">
        <path d="M9 11l3 3L22 4"></path>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
      </svg>
      <h3>All Caught Up!</h3>
      <p>You have no assigned tasks at the moment</p>
    </div>
    {% endif %}
  </div>
</div>

<style>
/* === Page Header === */
.page-header-card {
  background: linear-gradient(to right, #3b82f6 3px, transparent 3px);
  background-color: #fff;
  border-radius: 20px;
  padding: 32px;
  margin-bottom: 24px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.08);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 24px;
}

.header-left {
  flex: 1;
}

.page-title {
  margin: 0;
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-size: 32px;
  font-weight: 700;
  display: flex;
  align-items: center;
}

.page-subtitle {
  color: #64748b;
  margin: 8px 0 0 0;
  font-size: 15px;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

.filter-select {
  padding: 12px 20px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  border: 2px solid #e2e8f0;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  color: #1e293b;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 180px;
}

.filter-select:focus {
  border-color: #3b82f6;
  outline: none;
  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
}

.btn-modern {
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: white;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
  color: white;
}

.btn-outline {
  background: transparent;
  border: 2px solid #e2e8f0;
  color: #64748b;
}

.btn-outline:hover {
  background: #f8fafc;
  border-color: #3b82f6;
  color: #3b82f6;
  transform: translateY(-2px);
}

/* === Tasks Table === */
.tasks-table-card {
  background: #fff;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0,0,0,0.08);
}

.tasks-table {
  width: 100%;
  border-collapse: collapse;
}

.tasks-table thead {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
}

.tasks-table th {
  padding:  15px;
  text-align: left;
  color: white;
  font-weight: 600;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tasks-table tbody tr {
  border-bottom: 1px solid #f1f5f9;
  transition: all 0.2s ease;
}

.tasks-table tbody tr:hover {
  background: linear-gradient(90deg, #f0f9ff, #ffffff);
  transform: translateX(4px);
}

.tasks-table td {
  padding: 15px;
  vertical-align: middle;
  font-size: 14px;
  color: #334155;
}

/* === Task ID === */
.task-id {
  display: inline-block;
  padding: 6px 12px;
  background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
  color: #0284c7;
  border-radius: 8px;
  font-weight: 700;
  font-size: 13px;
}

/* === Task Title === */
.task-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  color: #1e293b;
  font-size: 15px;
}

/* Work Type Mini Badges */
.work-type-mini-badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  white-space: nowrap;
}

.work-type-task {
  background: linear-gradient(135deg, #64748b 0%, #475569 100%);
  color: #ffffff;
}

.work-type-bug {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: #ffffff;
}

.work-type-story {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #ffffff;
}

.work-type-defect {
  background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
  color: #ffffff;
}

.work-type-subtask {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  color: #ffffff;
}

.work-type-report {
  background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
  color: #ffffff;
}

.work-type-changerequest {
  background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
  color: #ffffff;
}

/* === Priority Badges === */
.priority-badge {
  display: inline-flex;
  align-items: center;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.3px;
  text-transform: uppercase;
}

.priority-low {
  background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
  color: #64748b;
}

.priority-normal {
  background: linear-gradient(135deg, #dbeafe, #bfdbfe);
  color: #1e40af;
}

.priority-high {
  background: linear-gradient(135deg, #fed7aa, #fdba74);
  color: #9a3412;
}

.priority-critical {
  background: linear-gradient(135deg, #fecaca, #fca5a5);
  color: #991b1b;
}

/* === Status Badges === */
.status-badge {
  display: inline-block;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.status-open {
  background: linear-gradient(135deg, #d1fae5, #a7f3d0);
  color: #065f46;
}

.status-in-progress {
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  color: #92400e;
}

.status-blocked {
  background: linear-gradient(135deg, #fecaca, #fca5a5);
  color: #991b1b;
}

.status-review {
  background: linear-gradient(135deg, #e9d5ff, #d8b4fe);
  color: #6b21a8;
}

.status-closed {
  background: linear-gradient(135deg, #dbeafe, #bfdbfe);
  color: #1e40af;
}

/* === Date Badges === */
.date-badge {
  display: inline-flex;
  align-items: center;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
}

.date-normal {
  background: #f8fafc;
  color: #64748b;
}

.date-overdue {
  background: linear-gradient(135deg, #fee2e2, #fecaca);
  color: #991b1b;
}

.date-completed {
  background: linear-gradient(135deg, #d1fae5, #a7f3d0);
  color: #065f46;
}

.date-empty {
  color: #cbd5e1;
  background: transparent;
}

/* === Action Buttons === */
.action-buttons {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.btn-action {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
}

.btn-view {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: white;
}

.btn-view:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

.btn-edit {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
  color: white;
}

.btn-edit:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}

/* === Empty State === */
.empty-state {
  text-align: center;
  padding: 80px 40px;
}

.empty-state svg {
  margin-bottom: 24px;
}

.empty-state h3 {
  margin: 0 0 12px 0;
  color: #1e293b;
  font-size: 24px;
  font-weight: 700;
}

.empty-state p {
  color: #64748b;
  font-size: 16px;
  margin: 0;
}

/* === Responsive === */
@media (max-width: 992px) {
  .header-content {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .header-actions {
    width: 100%;
    flex-wrap: wrap;
  }
  
  .btn-modern {
    flex: 1;
    justify-content: center;
  }
  
  .tasks-table {
    font-size: 13px;
  }
  
  .tasks-table th,
  .tasks-table td {
    padding: 12px 10px;
  }
}
</style>
<script>
// Make table rows clickable to open task detail (except when clicking action buttons)
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.task-row').forEach(function(row) {
    row.style.cursor = 'pointer';
    row.addEventListener('click', function() {
      var href = this.getAttribute('data-href');
      if (href) {
        window.location.href = href;
      }
    });
  });
  
  // Work type filter functionality
  const workTypeFilter = document.getElementById('workTypeFilter');
  if (workTypeFilter) {
    workTypeFilter.addEventListener('change', function() {
      const selectedType = this.value;
      const rows = document.querySelectorAll('.task-row');
      
      rows.forEach(function(row) {
        const taskId = row.getAttribute('data-href');
        if (!taskId) return;
        
        // Get work type from data attribute or row
        const workType = row.dataset.workType || '';
        
        if (selectedType === '' || workType === selectedType) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    });
  }
});
</script>
{% endblock %}
