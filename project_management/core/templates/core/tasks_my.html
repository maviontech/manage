{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">


  <!-- HEADER -->
    <div class="mb-4">
      <h4 class="fw-bold mb-1 text-gradient">
        <i class="fa-solid fa-clipboard-list me-2"></i> My Tasks
      </h4>
      <p class="text-muted small mb-3">View, track and manage your assigned work items.</p>
      <div class="d-flex justify-content-center align-items-center gap-6" style="margin-bottom:1.5rem;">
        <a href="{% url 'create_task' %}" class="btn btn-gradient btn-lg px-4" style="font-size:1rem; margin-right:8px;">
          <i class="fa-solid fa-plus me-2"></i> New Task
        </a>
        <a href="{% url 'task_board' %}" class="btn btn-gradient btn-lg px-4" style="font-size:1rem;">
          <i class="fa-solid fa-th-large me-4"></i> Board View
        </a>
      </div>
    </div>

  <!-- TABLE CARD -->
  <div class="card soft-card">
    <div class="card-body p-0">
      {% if tasks %}
      <div class="table-responsive">
        <table class="table align-middle mb-0 table-hover modern-table margin-center-auto">
          <thead>
            <thead>
            <tr class="thead-row">
              <th scope="col" style="min-width: 30px;">id</th>
              <th scope="col" style="min-width: 400px;">Title</th>
              <th scope="col" class="d-none d-lg-table-cell" style="width: 110px;">Priority</th>
              <th scope="col" class="d-none d-lg-table-cell" style="width: 150px;">Status</th>
              <th scope="col" class="text-center" style="width: 200px;">Due</th>
              <th scope="col" class="text-end" style="width: 225px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tasks %}
            <tr>
              <td class="text-muted small">#{{ t.id }}</td>
              <td>
                <div class="fw-semibold text-truncate">{{ t.title }}</div>
              </td>
              <td>
                <span class="badge priority {{ t.priority|lower }}">{{ t.priority }}</span>
              </td>
              <td>
                <span class="badge status {{ t.status|slugify }}">
                  <i class="fa-solid fa-circle me-1"></i> {{ t.status }}
                </span>
              </td>
              <td>
                {% if t.due_date %}
                  <span class="{% if t.due_date < today %}text-danger fw-semibold{% else %}text-muted{% endif %}">
                    <i class="fa-regular fa-clock me-1"></i>{{ t.due_date }}
                  </span>
                {% else %}
                  <span class="text-muted">â€”</span>
                {% endif %}
              </td>
              <td class="text-end">
              <div class="d-flex flex-row gap-2 align-items-center action-btn-row">
                  <a href="{% url 'task_detail' t.id %}" class="btn btn-action-circle" title="View">
                      <i class="fa-solid fa-eye"></i>
                  </a>
                  <a href="{% url 'edit_task' t.id %}" class="btn btn-action-circle" title="Edit">
                      <i class="fa-solid fa-pen"></i>
                  </a>
                  <button class="btn btn-action-circle btn-delete" title="Delete">
                      <i class="fa-solid fa-trash"></i>
                  </button>
              </div>
          </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="p-5 text-center text-muted">
        <i class="fa-regular fa-circle-check fa-2x mb-3"></i><br>
        You have no assigned tasks.
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- appended CSS: keeps your original styles and forces the submenu to viewport-fixed right center -->
<style>
/* preserve the original visual tokens */
.text-gradient { background: linear-gradient(90deg,#0b57a4,#38bdf8); -webkit-background-clip:text; color:transparent; }
.btn-gradient { background: linear-gradient(90deg,#0b57a4,#1f86e3,#38bdf8); color:#fff; border:none; border-radius:8px; padding:8px 14px; }
.btn-outline-gradient { border:1px solid #38bdf8; color:#0b57a4; border-radius:8px; padding:6px 12px; }
.soft-card { border-radius:12px; box-shadow:0 6px 18px rgba(13,38,71,0.06); border:none; }
.modern-table thead { background: linear-gradient(90deg, rgba(11,87,164,0.06), rgba(31,134,227,0.04)); color:#0b57a4; font-weight:600; }
.priority.low { background:#adb5bd; color:#fff; } .priority.normal { background:#0dcaf0; color:#00303f; } .priority.high { background:#ffc107; color:#1f1f1f; } .priority.critical { background:#dc3545; color:#fff; }
.status.closed { background:#198754; color:#fff; } .status.blocked { background:#212529; color:#fff; } .status.review { background:#ffc107; } .status.in-progress { background:#0b57a4; color:#fff; }
.action-btn { border-radius:8px; border:1px solid rgba(0,0,0,0.04); }
/* Circle action buttons for table actions */
.btn-action-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #15aaff;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  border: none;
  box-shadow: 0 2px 8px rgba(30,144,255,0.08);
  transition: background 0.18s, box-shadow 0.18s;
  margin-right: 2px;
}
.btn-action-circle:last-child {
  margin-right: 0;
}
.btn-action-circle:hover {
  background: #007bff;
  box-shadow: 0 4px 16px rgba(30,144,255,0.12);
  color: #fff;
}
.btn-action-circle.text-danger {
  background: #dc3545;
}
.btn-action-circle.text-danger:hover {
  background: #b02a37;
}
.btn-action-circle i {
  margin: 0;
}


/* Force vertical centering inside all table cells */
.modern-table td {
    vertical-align: middle !important;
}

/* Also center inner divs */
.modern-table td > div {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* center cell content horizontally */
.modern-table td {
    vertical-align: middle !important;
    text-align: center !important;
}

/* center inner divs (like Title column) */
.modern-table td > div {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center; /* horizontal center */
}



/* ---------- FIX: Position submenu fixed to viewport right and vertically centered ---------- */

/* make sure main container doesn't trap submenu positioning */
.container-fluid { position: relative; }

/* Position submenu fixed to viewport so it stays vertically centered regardless of page layout */
.task-submenu {
  position: fixed !important;
  right: 48px !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  z-index: 1200 !important;
  pointer-events: auto !important;
  width: 320px !important;
  margin: 0 !important;
}

/* Force horizontal row, stop vertical stacking */
.action-btn-row {
    display: flex !important;
    flex-direction: row !important;
    gap: 10px !important;
    align-items: center;
    justify-content: flex-end;
}

/* Remove strange margin stacking */
.btn-action-circle {
    margin-right: 0 !important;
}

/* Delete button coloring */
.btn-delete {
    background: #dc3545 !important;
    color: #fff !important;
}
.btn-delete:hover {
    background: #b02a37 !important;
}



/* submenu card */
.submenu-card {
  border-radius: 12px;
  padding: 10px;
  color: #fff;
  background: linear-gradient(180deg, rgba(11,87,164,0.96), rgba(31,134,227,0.92));
  box-shadow: 0 20px 40px rgba(11,87,164,0.09), inset 0 1px 0 rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(6px);
  overflow: visible;
}

/* compact list */
.submenu-list-compact { display:flex; flex-direction:column; gap:10px; padding:6px; }

/* items & hover glow */
.submenu-item-compact {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:10px;
  color:rgba(255,255,255,0.95); text-decoration:none; font-weight:600;
  transition: box-shadow .18s ease, transform .12s ease, background-color .12s ease, color .12s;
  border-left: 3px solid transparent; background: transparent; position:relative;
}
.submenu-item-compact:hover {
  transform: translateY(-2px);
  color: #fff !important;
  background: rgba(255,255,255,0.16) !important;
  box-shadow:
    0 0 18px rgba(255,255,255,0.65),
    0 0 36px rgba(255,255,255,0.35),
    0 0 60px rgba(255,255,255,0.18);
  border-left-color: rgba(255,255,255,0.95) !important;
}
.submenu-item-compact::after {
  content: "";
  position: absolute; left: -40%; top: -30%;
  width: 140%; height: 80%;
  background: linear-gradient(90deg, rgba(255,255,255,0.00), rgba(255,255,255,0.22), rgba(255,255,255,0.00));
  transform: rotate(-20deg);
  opacity: 0; transition: transform .45s ease, opacity .25s ease; pointer-events:none;
}
.submenu-item-compact:hover::after { transform: rotate(-18deg) translateX(-6%); opacity: 1; }

.submenu-item-compact.active {
  background: rgba(255,255,255,0.12) !important;
  color: #ffffff !important;
  border-left-color: #10b981 !important;
  box-shadow: 0 0 18px rgba(16,185,129,0.18) !important;
}
.submenu-card, .submenu-item-compact { overflow: visible !important; }

/* Responsive behavior: on narrow screens stack submenu below content */
@media (max-width: 992px) {
  .task-submenu {
    position: static !important;
    transform: none !important;
    width: 100% !important;
    margin-top: 12px !important;
  }
  .container-fluid { position: static; }
}
</style>
{% endblock %}
