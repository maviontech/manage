{% extends "core/base.html" %}
{% load static %}
{% block title %}Subprojects — {{ project.name }}{% endblock %}

{% block content %}
<div class="mavion-container">

  <div class="top-row d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-4">
    <div class="title-block w-100">
      <div class="title-with-badge d-flex align-items-center gap-3 mb-2 flex-wrap">
        <h1 class="page-title mb-0">Subprojects (WBS)</h1>
        <span class="project-badge">{{ project.name }}</span>
      </div>
      <p class="text-muted small mb-3">Manage the Work Breakdown Structure for this project. Add subprojects and maintain mapping to MDM/BG codes.</p>

      <form method="get" class="search-form d-flex align-items-center gap-2" role="search">
        <div class="input-group search-group">
          <span class="input-icon" aria-hidden>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2"/><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </span>
          <input name="q" class="form-control search-input" placeholder="Search subprojects..." value="{{ q|default:'' }}" aria-label="Search subprojects">
          <button type="submit" class="btn btn-primary btn-search">Search</button>
        </div>
      </form>
    </div>
  </div>

  <div class="projects-card mb-4">
    <div class="list-grid">
      {% for s in subprojects %}
      <div class="list-item d-flex justify-content-between align-items-start">
        <div class="left">
          <div class="d-flex align-items-center gap-2 mb-2">
            <div class="subproject-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V9C21 7.89543 20.1046 7 19 7H13L11 5H5C3.89543 5 3 5.89543 3 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="item-title fw-semibold">{{ s.name }}</div>
          </div>
          <div class="item-meta small text-muted">{{ s.description|default:"add on cursor button"|truncatechars:120 }}</div>
          <div class="item-sub small text-muted mt-3 d-flex gap-2 flex-wrap">
            {% if s.mdm_code %}<span class="code-tag code-tag-mdm">MDM: <strong>{{ s.mdm_code }}</strong></span>{% endif %}
            {% if s.bg_code %}<span class="code-tag code-tag-bg">BG: <strong>{{ s.bg_code }}</strong></span>{% endif %}
            {% if not s.mdm_code and not s.bg_code %}<span class="code-tag code-tag-empty">No codes mapped</span>{% endif %}
          </div>
        </div>

        <div class="right text-end d-flex flex-column align-items-end">
          <div class="small text-muted mb-3 date-badge">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="me-1" style="vertical-align: middle;">
              <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
              <path d="M16 2v4M8 2v4M3 10h18" stroke="currentColor" stroke-width="2"/>
            </svg>
            {{ s.created_at|date:"d M Y"|default:"—" }}
          </div>
          <div class="btn-row d-flex gap-2">
            <a href="{% url 'subproject_edit' project.id s.id %}" class="btn btn-sm action-icon-btn action-edit" title="Edit Subproject">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <a href="#" class="btn btn-sm action-icon-btn action-nav" title="Navigation">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="list-empty text-center text-muted py-6">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 11v6M9 14h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="fw-semibold mt-3 mb-1 text-dark">No subprojects yet</div>
        <div class="small">Click <a href="{% url 'subproject_create' project.id %}">Add Subproject</a> to create the first Work Breakdown Structure item.</div>
      </div>
      {% endfor %}
    </div>
    <div class="d-flex justify-content-center" style="margin-top:32px;">
      <a href="{% url 'subproject_create' project.id %}" class="btn btn-primary btn-create d-flex align-items-center">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="me-2" aria-hidden><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>
        Add Subproject
      </a>
    </div>
  </div>

  {% if pages|default:0 > 1 %}
  <nav aria-label="Subprojects pagination" class="d-flex justify-content-center">
    <ul class="pagination mavion-pagination">
      {% if page > 1 %}
      <li class="page-item"><a class="page-link" href="?page={{ page|add:-1 }}{% if q %}&q={{ q }}{% endif %}">Previous</a></li>
      {% endif %}
      {% for i in page_range %}
      <li class="page-item {% if i == page %}active{% endif %}"><a class="page-link" href="?page={{ i }}{% if q %}&q={{ q }}{% endif %}">{{ i }}</a></li>
      {% endfor %}
      {% if page < pages %}
      <li class="page-item"><a class="page-link" href="?page={{ page|add:1 }}{% if q %}&q={{ q }}{% endif %}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

</div>

<style>
/* ========== Modern UI for Subprojects List ========== */
.mavion-container { 
  max-width: 1300px; 
  margin: 0 auto; 
  padding: 2rem 1.5rem;
  background: linear-gradient(135deg, #f8fafc 0%, #e8f0fe 100%);
  min-height: 100vh;
}

/* ========== Header Section ========== */
.title-with-badge {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.page-title { 
  font-size: 2rem; 
  font-weight: 800; 
  margin: 0; 
  background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.5px;
}

.project-badge {
  display: inline-block;
  padding: 0.5rem 1.2rem;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #ffffff;
  font-weight: 700;
  font-size: 0.95rem;
  border-radius: 10px;
  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
  letter-spacing: 0.3px;
  transition: all 0.3s ease;
}

.project-badge:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

.title-block p { 
  margin-bottom: 1rem; 
  color: #64748b; 
  font-size: 0.95rem;
  font-weight: 500;
  line-height: 1.6;
}

/* ========== Search Section ========== */
.search-group { 
  display: flex; 
  align-items: center; 
  border-radius: 12px; 
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border: 2px solid rgba(59, 130, 246, 0.1);
  box-shadow: 0 4px 20px rgba(59, 130, 246, 0.12), 0 1px 3px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  transition: all 0.3s ease;
}

.search-group:focus-within {
  border-color: rgba(59, 130, 246, 0.4);
  box-shadow: 0 8px 30px rgba(59, 130, 246, 0.2), 0 2px 8px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.input-icon { 
  padding: 0 14px; 
  color: #64748b; 
  display: flex; 
  align-items: center; 
}

.search-input { 
  border: 0; 
  padding: 0.75rem 1rem; 
  min-width: 300px;
  background: transparent;
  font-size: 0.95rem;
  font-weight: 500;
  color: #1e293b;
}

.search-input:focus { 
  box-shadow: none; 
  outline: none;
}

.search-input::placeholder { 
  color: #94a3b8; 
}

.btn-search { 
  border-radius: 0 10px 10px 0; 
  padding: 0 1.5rem;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border: none;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-search:hover {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  transform: translateX(2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

/* ========== Add Button ========== */
.btn-create { 
  padding: 1rem 2rem; 
  border-radius: 14px; 
  font-weight: 700;
  font-size: 1.05rem;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border: none;
  color: white;
  box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25), 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  letter-spacing: 0.3px;
}

.btn-create:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 32px rgba(16, 185, 129, 0.35), 0 4px 12px rgba(0, 0, 0, 0.15);
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  color: white;
}

/* ========== Card & List Grid ========== */
.projects-card { 
  border: 0; 
}

.list-grid { 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding: 0; 
}

/* ========== List Item (Card Design) ========== */
.list-item { 
  background: #ffffff;
  border-radius: 16px; 
  padding: 24px 28px; 
  display: flex; 
  align-items: start; 
  justify-content: space-between; 
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
  border: 2px solid rgba(59, 130, 246, 0.08);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.list-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.list-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 60px rgba(59, 130, 246, 0.15), 0 4px 12px rgba(0, 0, 0, 0.08);
  border-color: rgba(59, 130, 246, 0.3);
}

.list-item:hover::before {
  opacity: 1;
}

.subproject-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  border-radius: 10px;
  color: #3b82f6;
  flex-shrink: 0;
  transition: all 0.3s ease;
}

.list-item:hover .subproject-icon {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #ffffff;
  transform: rotate(5deg) scale(1.05);
}

.item-title { 
  font-weight: 800; 
  color: #0f172a; 
  font-size: 1.2rem;
  letter-spacing: -0.3px;
}

.item-meta { 
  margin-top: 8px; 
  color: #475569; 
  max-width: 720px; 
  font-size: 0.95rem;
  line-height: 1.6;
  font-weight: 500;
}

.item-sub { 
  margin-top: 12px; 
  color: #6b7280; 
}

.code-tag { 
  background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
  padding: 6px 14px; 
  border-radius: 8px; 
  font-size: 0.85rem; 
  font-weight: 600;
  border: 2px solid #e2e8f0;
  transition: all 0.3s ease;
  display: inline-block;
}

.code-tag:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.code-tag-mdm {
  border-color: rgba(59, 130, 246, 0.3);
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
}

.code-tag-bg {
  border-color: rgba(16, 185, 129, 0.3);
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
}

.code-tag-empty {
  border-color: rgba(245, 158, 11, 0.3);
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
  color: #d97706;
}

.code-tag strong { 
  color: #0f172a; 
  font-weight: 700;
}

/* ========== Date Badge ========== */
.date-badge {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 600;
  color: #475569;
  border: 2px solid #e2e8f0;
  display: inline-flex;
  align-items: center;
  margin-bottom: 1rem;
}

/* ========== Action Buttons ========== */
.action-icon-btn { 
  min-width: 44px; 
  height: 44px; 
  display: inline-flex; 
  align-items: center; 
  justify-content: center; 
  border-radius: 10px;
  border: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 16px;
}

.action-edit {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #ffffff;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.action-edit:hover {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  color: #ffffff;
  transform: translateY(-4px) rotate(5deg);
  box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
}

.action-nav {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #ffffff;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.action-nav:hover {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  color: #ffffff;
  transform: translateY(-4px) rotate(-5deg);
  box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
}

/* ========== Empty State ========== */
.list-empty { 
  background: #ffffff;
  border-radius: 16px; 
  padding: 60px 40px; 
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
  border: 2px solid rgba(59, 130, 246, 0.1);
}

.empty-icon {
  display: inline-block;
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1rem;
  color: #3b82f6;
}

.list-empty .fw-semibold {
  font-size: 1.3rem;
  font-weight: 700;
  color: #1e293b;
}

.list-empty a {
  color: #3b82f6;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
}

.list-empty a:hover {
  color: #2563eb;
  text-decoration: underline;
}

/* ========== Pagination ========== */
.mavion-pagination .page-link { 
  min-width: 44px; 
  height: 44px;
  border-radius: 10px; 
  margin: 0 0.25rem;
  font-weight: 600;
  border: 2px solid #e2e8f0;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  color: #475569;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.mavion-pagination .page-link:hover {
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  border-color: #3b82f6;
  color: #1e40af;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.mavion-pagination .page-item.active .page-link { 
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #fff; 
  border-color: #3b82f6;
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
  transform: translateY(-2px);
}

/* ========== Responsive Adjustments ========== */
@media (max-width:767px) {
  .mavion-container { padding: 1.5rem 1rem; }
  .page-title { font-size: 1.5rem; }
  .title-with-badge { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
  .project-badge { font-size: 0.85rem; padding: 0.4rem 1rem; }
  .top-row { gap: 1rem; }
  .title-block { width: 100%; }
  .search-input { min-width: unset; width: 100%; }
  .search-group { width: 100%; }
  .list-item { 
    flex-direction: column; 
    gap: 1rem; 
    padding: 18px 20px; 
    margin-top: 20px;
  }
  .right { 
    width: 100%; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    flex-direction: row !important; 
  }
  .right > div:first-child { order: 2; }
  .right .btn-row { order: 1; }
  .item-sub { flex-direction: column; gap: 0.5rem; }
  .action-icon-btn { min-width: 40px; height: 40px; }
  .date-badge { font-size: 0.75rem; padding: 4px 8px; }
  .btn-create { width: 100%; justify-content: centerumn; gap:.8rem; padding:14px; margin-top: 20px }
  .right { width:100%; display:flex; justify-content:space-between; align-items:center; flex-direction: row !important; }
  .right > div:first-child { order: 2; }
  .right .btn-row { order: 1; }
  .item-sub { flex-direction: column; gap: 0.5rem; }
  .search-input { min-width:unset; }
}
</style>
{% endblock %}